Cirac.mapsMenu=[{groupName:"Mapas base",maps:[{mapId:"mapquest",radio:!0,inputName:"base-layers"},{mapId:"esri-world-imagery",radio:!0,inputName:"base-layers"},{mapId:"esri-world-shaded-relief",radio:!0,inputName:"base-layers"},{mapId:"esri-world-gray-canvas",radio:!0,inputName:"base-layers"},{mapId:"mapquest-places",radio:!1}]},{groupName:"Índice de vulnerabilidade a inundação",maps:[{mapId:"cirac-vul-bgri-fvi-n",radio:!0,inputName:"cirac-layers"},{mapId:"cirac-vul-bgri-fvi-75",radio:!0,inputName:"cirac-layers"}]}],Cirac.layers=[{id:"cirac-vul-bgri-fvi-n",isCirac:!0,bounds:[-9.5691,36.8928,-6.1194,42.2244],center:[-8.2068,39.5676,9],minzoom:8,maxzoom:9,name:"Índice de vulnerabilidade a inundação por BGRI (moda)",description:"Índice de vulnerabilidade a inundação por BGRI (moda) - mais detalhes",legend:"<div class='my-legend'>\n<div class='legend-title'>Índice de vulnerabilidade a inundação por BGRI (moda)</div>\n<div class='legend-scale'>\n\n  <!--   BEGIN COLORS   |   BEGIN COLORS   |   BEGIN COLORS   -->\n  <ul class='legend-labels'>\n    <li><span style='background:#38A800;'></span>\n            Baixo: 3 – 5\n    </li>\n    <li><span style='background:#FFFF00;'></span>\n            Moderado: 6 – 7\n    </li>\n    <li><span style='background:#FF9500;'></span>\n            Elevado: 8 – 10\n    </li>\n    <li><span style='background:#FF0000;'></span>\n            Muito elevado: 11 – 12\n    </li>\n  </ul>\n  <!--   END COLORS   |   END COLORS   |   END COLORS   -->\n\n</div>\n\n<!--   BEGIN SOURCE   |   BEGIN SOURCE   |   BEGIN SOURCE   -->\n<div class='legend-source'>\n  Fonte: <a target='_blank' href='https://www.apseguradores.pt/site/cirac.aspx'>APS/CIRAC</a>\n</div>\n<!--   END SOURCE   |   END SOURCE   |   END SOURCE   -->\n\n</div>\n\n\n<style type='text/css'>\n  .my-legend .legend-title {\n    text-align: left;\n    margin-bottom: 5px;\n    font-weight: bold;\n    font-size: 90%;\n    }\n  .my-legend .legend-scale ul {\n    margin: 0;\n    margin-bottom: 5px;\n    padding: 0;\n    float: left;\n    list-style: none;\n    }\n  .my-legend .legend-scale ul li {\n    font-size: 80%;\n    list-style: none;\n    margin-left: 0;\n    line-height: 18px;\n    margin-bottom: 2px;\n    }\n  .my-legend ul.legend-labels li span {\n    display: block;\n    float: left;\n    height: 16px;\n    width: 30px;\n    margin-right: 5px;\n    margin-left: 0;\n    border: 1px solid #999;\n    }\n  .my-legend .legend-source {\n    font-size: 70%;\n    color: #999;\n    clear: both;\n    }\n  .my-legend a {\n    color: #777;\n    }\n</style>",tiles:[Cirac.tilesHost+"/tiles/cirac-vul-bgri-fvi-n/{z}/{x}/{y}.png"],grids:[Cirac.tilesHost+"/tiles/cirac-vul-bgri-fvi-n/{z}/{x}/{y}.grid.json"],template:'{{#__location__}}{{/__location__}}{{#__teaser__}}<script>\nvar value = {{{value}}};\nvar output = value;\nif(value>=3 && value <=5){\n    output = "<b>Índice de vulnerabilidade:</b> " + value + " (baixo)";\n    output += "<br><b>Descrição:</b> Áreas improváveis de ter inundações (E, PSI), e onde as comunidades são menos suscetíveis (SSI)";\n}\nelse if(value>=6 && value <= 7){\n    output = "<b>Índice de vulnerabilidade:</b> " + value + " (moderado)";\n    output += "<br><b>Descrição:</b> Áreas improváveis de sofrer danos durante ocorrências de inundações (E, PSI), e onde as comunidades tendem a ser menos suscetíveis (SSI).";\n}\nelse if(value>=8 && value <=10){\n    output = "<b>Índice de vulnerabilidade:</b> " + value + " (elevado)";\n    output += "<br><b>Descrição:</b> Áreas suscetíveis de sofrer danos durante ocorrências de inudações (E, PSI), e com comunidades suscetíveis (SSI).";\n}\nelse if(value>=11 && value <=12){\n    output = "<b>Índice de vulnerabilidade:</b> " + value + " (muito elevado)";\n    output += "<br><b>Descrição:</b> Áreas muito suscetíveis de sofrer danos durante ocorrências de inudações (E, PSI), e com comunidades suscetíveis (SSI)."; \n}\nelse{\n    output += "Indíce desconhecido";\n}\nreturn output;\n</script>{{/__teaser__}}{{#__full__}}{{/__full__}}'},{id:"cirac-vul-bgri-fvi-75",isCirac:!0,bounds:[-9.5691,36.8928,-6.1194,42.2244],center:[-8.0969,39.4489,9],minzoom:8,maxzoom:9,name:"Índice de vulnerabilidade a inundação por BGRI (percentil 75)",description:"Índice de vulnerabilidade a inundação por BGRI (percentil 75) - mais detalhes",legend:"<div class='my-legend'>\n<div class='legend-title'>Índice de vulnerabilidade a inundação por BGRI (percentil 75)</div>\n<div class='legend-scale'>\n\n  <!--   BEGIN COLORS   |   BEGIN COLORS   |   BEGIN COLORS   -->\n  <ul class='legend-labels'>\n    <li><span style='background:#38A800;'></span>\n            Baixo: 3 – 5\n    </li>\n    <li><span style='background:#FFFF00;'></span>\n            Moderado: 6 – 7\n    </li>\n    <li><span style='background:#FF9500;'></span>\n            Elevado: 8 – 10\n    </li>\n    <li><span style='background:#FF0000;'></span>\n            Muito elevado: 11 – 12\n    </li>\n  </ul>\n  <!--   END COLORS   |   END COLORS   |   END COLORS   -->\n\n</div>\n\n<!--   BEGIN SOURCE   |   BEGIN SOURCE   |   BEGIN SOURCE   -->\n<div class='legend-source'>\n  Fonte: <a target='_blank' href='https://www.apseguradores.pt/site/cirac.aspx'>APS/CIRAC</a>\n</div>\n<!--   END SOURCE   |   END SOURCE   |   END SOURCE   -->\n\n</div>\n\n\n<style type='text/css'>\n  .my-legend .legend-title {\n    text-align: left;\n    margin-bottom: 5px;\n    font-weight: bold;\n    font-size: 90%;\n    }\n  .my-legend .legend-scale ul {\n    margin: 0;\n    margin-bottom: 5px;\n    padding: 0;\n    float: left;\n    list-style: none;\n    }\n  .my-legend .legend-scale ul li {\n    font-size: 80%;\n    list-style: none;\n    margin-left: 0;\n    line-height: 18px;\n    margin-bottom: 2px;\n    }\n  .my-legend ul.legend-labels li span {\n    display: block;\n    float: left;\n    height: 16px;\n    width: 30px;\n    margin-right: 5px;\n    margin-left: 0;\n    border: 1px solid #999;\n    }\n  .my-legend .legend-source {\n    font-size: 70%;\n    color: #999;\n    clear: both;\n    }\n  .my-legend a {\n    color: #777;\n    }\n</style>",tiles:[Cirac.tilesHost+"/tiles/cirac-vul-bgri-fvi-75/{z}/{x}/{y}.png"],grids:[Cirac.tilesHost+"/tiles/cirac-vul-bgri-fvi-75/{z}/{x}/{y}.grid.json"],template:'{{#__location__}}{{/__location__}}{{#__teaser__}}<script>\nvar value = {{{value}}};\nvar output = value;\nif(value>=3 && value <=5){\n    output = "<b>Índice de vulnerabilidade:</b> " + value + " (baixo)";\n    output += "<br><b>Descrição:</b> Áreas improváveis de ter inundações (E, PSI), e onde as comunidades são menos suscetíveis (SSI)";\n}\nelse if(value>=6 && value <= 7){\n    output = "<b>Índice de vulnerabilidade:</b> " + value + " (moderado)";\n    output += "<br><b>Descrição:</b> Áreas improváveis de sofrer danos durante ocorrências de inundações (E, PSI), e onde as comunidades tendem a ser menos suscetíveis (SSI).";\n}\nelse if(value>=8 && value <=10){\n    output = "<b>Índice de vulnerabilidade:</b> " + value + " (elevado)";\n    output += "<br><b>Descrição:</b> Áreas suscetíveis de sofrer danos durante ocorrências de inudações (E, PSI), e com comunidades suscetíveis (SSI).";\n}\nelse if(value>=11 && value <=12){\n    output = "<b>Índice de vulnerabilidade:</b> " + value + " (muito elevado)";\n    output += "<br><b>Descrição:</b> Áreas muito suscetíveis de sofrer danos durante ocorrências de inudações (E, PSI), e com comunidades suscetíveis (SSI)."; \n}\nelse{\n    output += "Indíce desconhecido";\n}\nreturn output;\n</script>{{/__teaser__}}{{#__full__}}{{/__full__}}'}],Cirac.exclusiveLayers=[{id:"hydda-base",name:"Mapa base (Open Street Map)",description:"",minzoom:5,maxzoom:13,legend:"",tilejson:"2.0.0",attribution:"",tiles:["http://a.tile.openstreetmap.se/hydda/base/{z}/{x}/{y}.png"],isExclusive:!0,zIndex:-1},{id:"open-topo-map",name:"Mapa topográfico (OSM)",description:"",descriptionx:"Mapa topográfico renderizado com dados do Open Street Map e do projecto SRTM. Mais informações: <a href='http://wiki.openstreetmap.org/wiki/OpenTopoMap' target='_blank'>Wiki do Open Street Map</a>",minzoom:5,maxzoom:13,legend:"",tilejson:"2.0.0",attribution:"",tiles:["http://a.tile.opentopomap.org/{z}/{x}/{y}.png"],isExclusive:!0,zIndex:-1},{id:"esri-world-shaded-relief",name:"Modelo digital de terreno (ESRI)",description:"",minzoom:5,maxzoom:13,legend:"",tilejson:"2.0.0",attribution:"",tiles:["http://server.arcgisonline.com/ArcGIS/rest/services/World_Shaded_Relief/MapServer/tile/{z}/{y}/{x}.jpg"],isExclusive:!0,zIndex:-1},{id:"esri-world-gray-canvas",name:"Mapa dos rios (ESRI)",description:"",minzoom:5,maxzoom:13,legend:"",tilejson:"2.0.0",attribution:"",tiles:["http://server.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}.jpg"],isExclusive:!0,zIndex:-1},{id:"mapquest",name:"Mapa geral (MapQuest)",description:"",minzoom:5,maxzoom:13,legend:"",tilejson:"2.0.0",attribution:"",tiles:["http://otile1.mqcdn.com/tiles/1.0.0/map/{z}/{x}/{y}.jpg"],isExclusive:!0,zIndex:-1},{id:"esri-world-street-map",name:"Mapa geral (ESRI)",description:"",minzoom:5,maxzoom:13,legend:"",tilejson:"2.0.0",attribution:"",tiles:["http://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}.jpg"],isExclusive:!0,zIndex:-1},{id:"esri-world-imagery",name:"Mapa de satélite (ESRI)",description:"",minzoom:5,maxzoom:13,legend:"",tilejson:"2.0.0",attribution:"",tiles:["http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}.jpg"],isExclusive:!0,zIndex:-1},{id:"here-satellite-day",name:"Mapa de satélite (Here)",description:"",minzoom:5,maxzoom:13,legend:"",tilejson:"2.0.0",attribution:"",format:"png",tiles:["http://1.aerial.maps.cit.api.here.com/maptile/2.1/maptile/newest/satellite.day/{z}/{x}/{y}/256/png8?app_id=Y8m9dK2brESDPGJPdrvs&app_code=dq2MYIvjAotR8tHvY8Q_Dg"],isExclusive:!0,zIndex:-1},{id:"mapquest-places",name:"Nomes das localidades (MapQuest)",description:"",minzoom:5,maxzoom:13,legend:"",tilejson:"2.0.0",attribution:"",tiles:["http://otile1.mqcdn.com/tiles/1.0.0/hyb/{z}/{x}/{y}.png"],isExclusive:!1,zIndex:19}];var Cartografia=new Mn.Application;Cartografia.addRegions({mapOneRegion:"#mn-r-map-1",modalOneRegion:"#mn-r-modal-contents-1"}),Cartografia.on("start",function(){var map0IV=new MapIV({model:map0M});this.mapOneRegion.show(map0IV)}),L.Browser.retina=!1,L.mapbox.accessToken="dummyAccessToken",Cartografia.getMapModel=function(mapIndex){if(0===mapIndex)return map0M;if(1===mapIndex)return map1M;throw new Error("wrong map index")},Cartografia.hasUTFGrid=function(tileJson){return!!tileJson.template};var cartografiaChannel=Backbone.Radio.channel("cartografia");cartografiaChannel.reply("selectLayer",function(mapIndex,layerId){mapIndex=0;var mapM=Cartografia.getMapModel(mapIndex),layerM=mapM.get("ciracLayersC").get(layerId)||mapM.get("exclusiveLayersC").get(layerId)||mapM.get("overlappingLayersC").get(layerId);if(!layerM)throw new Error("Unknown layerId: ",layerId);layerM.select()}),cartografiaChannel.reply("deselectLayer",function(mapIndex,layerId){mapIndex=0;var mapM=Cartografia.getMapModel(mapIndex),layerM=mapM.get("overlappingLayersC").get(layerId);if(!layerM)throw new Error("Unknown layerId: ",layerId);layerM.deselect()});var ControlLV=Mn.LayoutView.extend({onRender:function(){this.disableMouseInteractions()},disableMouseInteractions:function(){$(this.el).on("mousewheel DOMMouseScroll MozMousePixelScroll dblclick",function(e){e.stopPropagation()});var eventName="mousedown";("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)&&(eventName="touchstart"),$(this.el).on(eventName,function(e){e.stopPropagation()}),$(this.el).on("dblclick",function(e){e.stopPropagation()}),$(this.el).on("click",function(e){e.stopPropagation()})}});L.Control.BackboneView=L.Control.extend({options:{position:"bottomright"},initialize:function(options){L.Util.setOptions(this,options),options.view&&(this._view=options.view)},onAdd:function(map){return this._view&&(this._view._map=this._map),this._view.el},onRemove:function(map){},getView:function(){return this._view}});var LayerM=Backbone.Model.extend({initialize:function(){Backbone.Select.Me.applyTo(this),this.on("change:opacity",this.changeOpacity),this.on("change:zindex",this.changeZIndex)},changeOpacity:function(model,newOpacity){this.get("tileLayer").setOpacity(newOpacity/100)},changeZIndex:function(model,newZIndex){this.get("tileLayer").setZIndex(newZIndex)}}),LayersBaseC=Backbone.Collection.extend({addTileLayer:function(layerM){var leafletMap=layerM.collection.parent.get("leafletMap");if(leafletMap&&!leafletMap.hasLayer(layerM.get("tileLayer"))){leafletMap.addLayer(layerM.get("tileLayer")),layerM.get("zindex")&&layerM.get("tileLayer").setZIndex(layerM.get("zindex")),layerM.has("gridLayer")&&(leafletMap.addLayer(layerM.get("gridLayer")),leafletMap.addControl(layerM.get("gridControl")));var legend=layerM.get("tileJson").legend;legend&&leafletMap.legendControl.addLegend(legend)}},removeTileLayer:function(layerM){var leafletMap=layerM.collection.parent.get("leafletMap");if(leafletMap&&leafletMap.hasLayer(layerM.get("tileLayer"))){leafletMap.removeLayer(layerM.get("tileLayer")),layerM.has("gridLayer")&&(leafletMap.removeLayer(layerM.get("gridLayer")),leafletMap.removeControl(layerM.get("gridControl")));var legend=layerM.get("tileJson").legend;legend&&leafletMap.legendControl.removeLegend(legend);var mapsMenu=layerM.collection.parent.get("mapsMenu");_.each(mapsMenu,function(groupObj){_.each(groupObj.maps,function(mapObj){mapObj.mapId===layerM.get("id")&&(mapObj.active=!1)},this)},this)}},updateMenuEntry:function(layerM,status){var mapsMenu=layerM.collection.parent.get("mapsMenu");_.each(mapsMenu,function(groupObj){_.each(groupObj.maps,function(mapObj){mapObj.mapId===layerM.get("id")&&(mapObj.active=status)},this)},this)},addLayer:function(layerM){var tileLayer=layerM.get("tileLayer");if(tileLayer&&tileLayer instanceof L.TileLayer)this.addTileLayer(layerM),this.updateMenuEntry(layerM,!0);else{if(!(tileLayer instanceof Backbone.Collection))throw new Error("invalid Tilelayer");layerM.addSequentialControl(),this.updateMenuEntry(layerM,!0)}},removeLayer:function(layerM){var tileLayer=layerM.get("tileLayer");if(tileLayer&&tileLayer instanceof L.TileLayer)this.removeTileLayer(layerM),this.updateMenuEntry(layerM,!1);else{if(!(tileLayer instanceof Backbone.Collection))throw new Error("invalid Tilelayer");layerM.removeSequentialControl(),this.updateMenuEntry(layerM,!1)}}}),OverlappingLayersC=LayersBaseC.extend({model:LayerM,initialize:function(models){Backbone.Select.Many.applyTo(this,models),this.on("select:some select:all select:none",this.updateLayers)},updateLayers:function(diff){var i,l,selected=diff.selected,deselected=diff.deselected;for(i=0,l=selected.length;l>i;i++)this.addLayer(selected[i]);for(i=0,l=deselected.length;l>i;i++)this.removeLayer(deselected[i])}}),ExclusiveLayersC=LayersBaseC.extend({model:LayerM,initialize:function(models){Backbone.Select.One.applyTo(this,models),this.on("select:one",this.addLayer),this.on("deselect:one",this.removeLayer)}}),MapM=Backbone.Model.extend({initialize:function(){}}),map0M=new MapM({mapIndex:0,active:!1,menuOpen:!1,ciracLayersC:new ExclusiveLayersC,exclusiveLayersC:new ExclusiveLayersC,overlappingLayersC:new OverlappingLayersC,center:{lat:39.5676,lng:-8.7068},initialZoom:8,maxZoom:9,minZoom:8});map0M.get("ciracLayersC").parent=map0M,map0M.get("exclusiveLayersC").parent=map0M,map0M.get("overlappingLayersC").parent=map0M,_.each(Cirac.exclusiveLayers,function(tileJson){Cirac.layers.unshift(tileJson)}),map0M.set("mapsMenu",JSON.parse(JSON.stringify(Cirac.mapsMenu))),_.each(map0M.get("mapsMenu"),function(groupObj){_.each(groupObj.maps,function(mapObj){var tileJson=_.findWhere(Cirac.layers,{id:mapObj.mapId});if(tileJson){var mapIndex=0;mapObj.mapIndex=mapIndex,mapObj.name=tileJson.name,mapObj.hasInfo=$.trim(tileJson.description).length>0,tileJson.maxzoom=9;var layerM=new LayerM({id:tileJson.id,zindex:tileJson.zIndex||0,opacity:100,tileJson:tileJson,mapIndex:mapIndex});if(tileJson.tiles&&tileJson.minzoom&&tileJson.maxzoom&&(layerM.set("tileLayer",L.mapbox.tileLayer(tileJson)),Cartografia.hasUTFGrid(tileJson))){layerM.set("gridLayer",L.mapbox.gridLayer(tileJson));var gridControlOptions={},sanitizer=function(data){var scriptTags=["<script>","</script>"],indexStart=data.indexOf(scriptTags[0]),indexEnd=data.indexOf(scriptTags[1]);if(-1===indexStart||-1===indexEnd)return data;var fn,code=$.trim(data.substring(indexStart+scriptTags[0].length,indexEnd));try{fn=new Function(code)}catch(e){fn=new Function("return 'Error in the teaser definition: "+e.message+"';")}finally{return fn()}},gridControlOptions={sanitizer:sanitizer};layerM.set("gridControl",L.mapbox.gridControl(layerM.get("gridLayer"),gridControlOptions))}tileJson.isExclusive?map0M.get("exclusiveLayersC").push(layerM):tileJson.isCirac?map0M.get("ciracLayersC").push(layerM):map0M.get("overlappingLayersC").push(layerM)}})}),window.Behaviors=window.Behaviors||{},window.Behaviors.ShowModal=Marionette.Behavior.extend({events:function(){var eventsHash={},eventType=this.options.eventType||"click";return eventsHash[eventType+" @ui."+this.options.uiKey]="showModal",eventsHash},showModal:function(e){var $anchor=$(e.currentTarget);e.preventDefault();var mapIndex=0,mapM=Cartografia.getMapModel(mapIndex),layerId=$anchor.data("mapId"),layerM=mapM.get("ciracLayersC").get(layerId)||mapM.get("exclusiveLayersC").get(layerId)||mapM.get("overlappingLayersC").get(layerId);if(!layerM)throw new Error("Unknown mapId");var modalView=new this.options.viewClass({model:layerM}),$modal=$("#modal-1"),region=Cartografia.modalOneRegion;region.show(modalView),$modal.modal("show")}}),window.Behaviors.CloseModal=Marionette.Behavior.extend({events:{"click @ui.closeBtn":"closeModal"},closeModal:function(){var $modal=$("#modal-1");$modal.modal("hide"),this.view.destroy()}});var ModalMoreInfoIV=Mn.ItemView.extend({template:"menu/templates/modal-map-info.html",ui:{closeBtn:"button.js-modal-cancel"},behaviors:{CloseModal:{behaviorClass:window.Behaviors.CloseModal}}}),ModalMapOptionsIV=Mn.ItemView.extend({template:"menu/templates/modal-map-options.html",ui:{closeBtn:"button.js-modal-cancel",updateBtn:"button.js-modal-update"},events:{"click @ui.updateBtn":"updateMap"},behaviors:{CloseModal:{behaviorClass:window.Behaviors.CloseModal}},updateMap:function(){var opacity=parseInt(this.$("#opacity").val(),10);_.isNumber(opacity)&&opacity>=0&&100>=opacity&&this.model.set("opacity",opacity);var zindex=parseInt(this.$("#zindex").val(),10);_.isNumber(zindex)&&zindex!==this.model.get("zindex")&&this.model.set("zindex",zindex),$("#modal-1").modal("hide"),this.destroy()}}),MenuBodyIV=Mn.ItemView.extend({template:"menu/templates/menu-body.html",ui:{chkBox:"input.js-select-layer[type='checkbox']",radio:"input.js-select-layer[type='radio']",infoBtn:"a.js-map-more-info",optionsBtn:"a.js-map-options"},events:{"change @ui.radio":"inputClicked","change @ui.chkBox":"inputClicked","click @ui.infoBtn":"showInfoModal","click @ui.optionsBtn":"showOptionsModal"},behaviors:{ShowOptionsModal:{behaviorClass:window.Behaviors.ShowModal,uiKey:"optionsBtn",eventType:"click",viewClass:ModalMapOptionsIV},ShowInfoModal:{behaviorClass:window.Behaviors.ShowModal,uiKey:"infoBtn",eventType:"click",viewClass:ModalMoreInfoIV}},inputClicked:function(e){var $input=$(e.target),mapId=$input.data("mapId"),mapIndex=this.model.get("mapIndex");$input.is(":checked")?cartografiaChannel.request("selectLayer",mapIndex,mapId):cartografiaChannel.request("deselectLayer",mapIndex,mapId)},onAttach:function(){this.$("#tree-menu").treed({openedClass:"glyphicon-chevron-right",closedClass:"glyphicon-chevron-down"}),this.$(".js-map-group").trigger("click")}}),MenuLV=ControlLV.extend({template:"menu/templates/menu.html",modelEvents:{"change:menuOpen":"toggleRegion"},ui:{menuBtn:"i.menu-icon",fullscreenBtn:"a.js-full-screen"},events:{"click @ui.menuBtn":"toggleMenuOpen","click @ui.fullscreenBtn":"fullscreenBtnClicked"},regions:{bodyRegion:"div.mn-r-menu-body"},fullscreenBtnClicked:function(){$.fullscreen.isFullScreen()?cartografiaChannel.request("closeFullscreen","#map-container"):cartografiaChannel.request("openFullscreen","#map-container")},toggleMenuOpen:function(){var menuOpen=this.model.get("menuOpen");this.model.set("menuOpen",!menuOpen)},toggleRegion:function(e){this.model.get("menuOpen")===!0?this.show():this.reset()},show:function(){this.$el.css("height","97%"),this.$(".menu-container").addClass("map-menu-open");var menuBodyIV=new MenuBodyIV({model:this.model});this.bodyRegion.show(menuBodyIV);var menuBodyHeight=this.$(".menu-container").height()-this.$(".menu-header").height();this.bodyRegion.currentView.$el.css("height",menuBodyHeight),this.bodyRegion.currentView.$el.css("overflow-x","auto")},reset:function(){this.bodyRegion.reset(),this.$el.css("height",""),this.$(".menu-container").removeClass("map-menu-open")}}),MapIV=Mn.ItemView.extend({attributes:{style:"height: 100%; xborder: solid green 1px; "},template:"map/templates/map-container.html",initialize:function(){},initializeMap:function(){var mapIndex=this.model.get("mapIndex"),center=this.model.get("center"),initialZoom=this.model.get("initialZoom"),maxZoom=this.model.get("maxZoom"),minZoom=this.model.get("minZoom"),div=this.$("div.mn-leaflet-map").get(mapIndex);this.map=L.mapbox.map(div,void 0,{zoomControl:!1,attributionControl:!1,zoom:initialZoom,maxZoom:maxZoom,minZoom:minZoom,center:[center.lat,center.lng]}),this.model.set("active",!0),this.model.set("leafletMap",this.map),cartografiaChannel.request("selectLayer",0,"mapquest"),_.each(Cartografia.queryParams,function(value,layerId){cartografiaChannel.request("selectLayer",0,layerId)}),delete Cartografia.queryParams},initializeMapMenu:function(){this.menuLV=new MenuLV({model:this.model}),this.menuLV.render(),this.menuControl=new L.Control.BackboneView({view:this.menuLV,position:"topleft"}),this.map.addControl(this.menuControl),this.menuLV.$el.parent().css("height","100%"),this.menuLV.$el.parent().parent().css("height","100%")},initializeZoom:function(options){var defaultOptions={position:"topright"},zoomControl=L.control.zoom(_.extend(defaultOptions,options));this.map.addControl(zoomControl)},initializeScale:function(options){var defaultOptions={position:"bottomright",imperial:!1,maxWidth:130},scaleControl=L.control.scale(_.extend(defaultOptions,options));window.scaleControl=scaleControl,this.map.addControl(scaleControl)},onAttach:function(){this.initializeMap(),this.initializeMapMenu(),this.initializeZoom(),this.initializeScale(),map0M.set("menuOpen",!0)}});Cartografia.start();